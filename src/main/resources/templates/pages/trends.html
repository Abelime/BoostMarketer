<!--
=========================================================
* Soft UI Dashboard - v1.0.7
=========================================================

* Product Page: https://www.creative-tim.com/product/soft-ui-dashboard
* Copyright 2023 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="/assets/img/favicon.png">
  <title>
    BoostMarketer - 마케팅을 위한 플랫폼
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="/assets/css/soft-ui-dashboard.css?v=1.0.7" rel="stylesheet" />
  <link href="/css/table.css" rel="stylesheet" />
  <link href="/css/common.css" rel="stylesheet" />
  <!-- Nepcha Analytics (nepcha.com) -->
  <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
  <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
</head>
<style>
  .flex-container {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /*custom-btn*/
  .btn-custom {
    border: 1px solid #ccc; /* Light grey border */
    background-color: white;
    color: #333;
    padding: 10px 20px;
    border-radius: 20px; /* Rounded edges */
    margin: 5px;
    font-size: 0.8rem; /* Smaller font size */
    transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effect */
    cursor: pointer;
    display: inline-flex; /* Aligns icon and text */
    align-items: center; /* Aligns items vertically */
  }

  .btn-custom:hover {
    background-color: #f0f0f0; /* Light grey background on hover */
    color: #333;
  }

  .btn-custom i {
    margin-right: 5px; /* Space between icon and text */
  }

  .btn-custom-blue {
    border-color: #007bff; /* Bootstrap primary blue */
    color: #007bff;
  }

  .btn-custom-blue:hover {
    background-color: #e7f3ff; /* Lighter blue background on hover */
  }

  /* FontAwesome icons */
  .icon-left {
    margin-right: 8px;
  }

  .button-group {
    display: flex;
    gap: 8px; /* Adjust the space between buttons */
  }

  .rank-btn {
    padding: 5px 15px; /* Reduced padding for smaller button size */
    border: none;
    border-radius: 20px; /* Rounded corners */
    font-size: 0.8rem; /* Smaller font size */
    color: #fff; /* White text color */
    cursor: pointer;
    transition: background-color 0.3s; /* Smooth transition for background color */
  }

  /* Light background and darker text for each button */
  #total {
    background-color: #e8e8e8; /* Light gray */
    color: #6c757d; /* Dark gray */
  }

  .first{
    color: #28a745; /* Dark green */
  }

  .second {
    color: #dc3545; /* Dark red */
  }

  .third {
    color: #087f8c; /* Dark teal */
  }

  .fourth {
    color: #007bff; /* Dark blue */
  }

  .fifth {
    color: #6f42c1; /* Dark purple */
  }

  #first {
    background-color: #e9f5db; /* Light green */
    color: #28a745; /* Dark green */
  }

  #second {
    background-color: #fde9e9; /* Light red */
    color: #dc3545; /* Dark red */
  }

  #third {
    background-color: #b2f2eb; /* Light teal */
    color: #087f8c; /* Dark teal */
  }

  #fourth {
    background-color: #e1f0ff; /* Light blue */
    color: #007bff; /* Dark blue */
  }

  #fifth {
    background-color: #dcdcf5; /* Light purple */
    color: #6f42c1; /* Dark purple */
  }

  .rank-btn.selected {
    font-weight: bold;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); /* Shadow to lift the button */
  }


  /*custom-select*/
  .custom-select-wrapper {
    width: 110px;
    position: relative;
    display: inline-block;
  }

  .custom-select {
    width: 105px;
    padding: 8px 16px; /* Adjust padding as needed */
    border: 1px solid #28a745; /* Green border for the element */
    background-color: #ffffff; /* White background */
    color: #28a745; /* Green text color */
    border-radius: 0; /* Square edges */
    -webkit-appearance: none; /* Removes default Webkit styling */
    -moz-appearance: none; /* Removes default Mozilla styling */
    appearance: none; /* Removes default styling */
    position: relative;
    font-size: 0.875rem; /* Font size */
  }

  /* Custom arrow indicator */
  .custom-select-wrapper::after {
    content: '\25BC'; /* Unicode down arrow */
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    color: #28a745; /* Green arrow color */
    pointer-events: none;
  }

  /* Remove the focus outline and modify border color */
  .custom-select:focus {
    outline: none;
    border-color: #34ce57; /* Light green border for focus */
  }

  #chart-container {
    width: 80%;
    margin: auto;
  }
  canvas {
    max-width: 100%; /* Canvas의 최대 너비 설정 */
    height: auto; /* 높이를 자동으로 조정하여 가로 비율을 유지함 */
  }
  .month-inputs {
    display: none;
  }
</style>

<body class="g-sidenav-show  bg-gray-100">
<div th:replace="~{common/aside}"></div>
<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
  <!-- Navbar -->
  <div th:replace="~{common/navbar}"></div>
  <!-- End Navbar -->
  <div class="container-fluid py-4">
    <div class="row">
      <div class="col-xl-6 col-sm-6 mb-xl-0 mb-4">
        <div class="card">
          <div class="card-body p-3">
            <div class="row">
              <div class="col-8">
                <div class="numbers">
                  <p class="text-sm mb-0 text-capitalize font-weight-bold">키워드 수</p>
                  <h5 class="font-weight-bolder mb-0" th:text="${totalCount}"></h5>
                </div>
              </div>
              <div class="col-4 text-end">
                <div class="icon icon-shape bg-gradient-success shadow text-center border-radius-md">
                  <i class="ni ni-chart-bar-32 text-lg opacity-10" aria-hidden="true"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-6 col-sm-6 mb-xl-0 mb-4">
        <div class="card">
          <div class="card-body p-3">
            <div class="row">
              <div class="col-8">
                <div class="numbers">
                  <p class="text-sm mb-0 text-capitalize font-weight-bold">상위노출 키워드 수</p>
                  <h5 class="font-weight-bolder mb-0" th:text="${keywordRankCount}"></h5>
                </div>
              </div>
              <div class="col-4 text-end">
                <div class="icon icon-shape bg-gradient-success shadow text-center border-radius-md">
                  <i class="ni ni-chart-bar-32 text-lg opacity-10" aria-hidden="true"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row col-12 mt-4">
      <div class="flex-container">
        <div class="custom-select-wrapper">
          <select class="custom-select" id="category">
            <option>카테고리</option>
            <option value="1" th:selected="${inputCategory == 1}">1순위</option>
            <option value="2" th:selected="${inputCategory == 2}">2순위</option>
            <option value="3" th:selected="${inputCategory == 3}">3순위</option>
            <option value="4" th:selected="${inputCategory == 4}">4순위</option>
            <option value="5" th:selected="${inputCategory == 5}">5순위</option>
          </select>
        </div>
        <div class="col-4">
          <div class="input-group">
            <input type="text" id="keyword" th:value="${keyword}" class="form-control" placeholder="희망하는 키워드를 등록해주세요">
            <a href="#" id="submitBtn">
              <div class="icon icon-shape bg-gradient-success shadow text-center border-radius-md">
                <i class="fa fa-pencil text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-5">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0">
            <div class="d-flex bd-highlight">
              <div class="p-2 flex-grow-1 bd-highlight">
                <h6>검색 트렌드 </h6>
              </div>
              <div class="p-2 bd-highlight">
                <div style="width: 145px;" class="page-select-wrapper">
                  <select id="page-sort" style="width: 100%;" class="page-select">
                    <option value="category" th:selected="${sort == 'category'}">카테고리 순</option>
                    <option value="highSearch" th:selected="${sort == 'highSearch'}">검색량 높은순</option>
                    <option value="lowSearch" th:selected="${sort == 'lowSearch'}">검색량 낮은순</option>
                    <option value="highRank" th:selected="${sort == 'highRank'}">블로그탭 높은순</option>
                    <option value="lowRank" th:selected="${sort == 'lowRank'}">블로그탭 낮은순</option>
                    <option value="highExposure" th:selected="${sort == 'highExposure'}">노출수 많은순</option>
                    <option value="lowExposure" th:selected="${sort == 'lowExposure'}">노출수 작은순</option>
                  </select>
                </div>
              </div>
              <div th:insert="~{common/pageSelect}"></div>
            </div>

            <div class="d-flex">

              <div class="dropdown me-2" style="display: inline">
                <label for="dateType_Sel">날짜 단위 선택:</label>
                <select id="dateType_Sel">
                  <option value="daily" selected>일별</option>
                  <option value="monthly">월별</option>
                </select>
                <br><br>

                <div id="dailyInputs">
                  <label for="startDate_Sel">시작 날짜:</label>
                  <input type="date" id="startDate_Sel" name="startDate_Sel" ><br><br>

                  <label for="endDate_Sel">종료 날짜:</label>
                  <input type="date" id="endDate_Sel" name="endDate_Sel" ><br><br>


                </div>

                <div id="monthlyInputs" class="month-inputs">
                  <label for="startYear_Sel">시작 년:</label>
                  <select id="startYear_Sel">
                    <!-- 여기에 올해까지의 년도를 추가합니다 -->
                    <!-- JavaScript를 사용하여 올해의 년도를 동적으로 생성할 수도 있습니다 -->
                  </select>
                  <label for="startMonth_Sel">시작 월:</label>
                  <select id="startMonth_Sel">

                  </select><br><br>

                  <label for="endYear_Sel">종료 년:</label>
                  <select id="endYear_Sel">
                    <!-- 여기에 올해까지의 년도를 추가합니다 -->
                    <!-- JavaScript를 사용하여 올해의 년도를 동적으로 생성할 수도 있습니다 -->
                  </select>
                  <label for="endMonth_Sel">종료 월:</label>
                  <select id="endMonth_Sel">

                  </select><br><br>

                </div>
              </div>

            </div>
          </div>
          <div class="card-body px-0 pt-0 pb-2 justify-content-center mt-2">
            <div class="table-responsive p-0">
              <div id="chart-container">
                <canvas id="line-chart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
      <nav id="pagination" aria-label="Page navigation example"></nav>
      <div class="d-flex justify-content-end">

      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0">
            <div class="d-flex bd-highlight">
              <div class="p-2 flex-grow-1 bd-highlight">
                <h6>섹션 배치 목록 </h6>
              </div>
            </div>
          </div>
          <div class="card-body px-0 pt-0 pb-2 justify-content-center mt-2">
            <div class="table-responsive p-0">
              <table class="table align-items-center mb-0">
                <thead>
                  <tr class="text-center">
                    <th>섹션</th>
                    <th>노출</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="item : ${dataList2}">
                    <td th:text="${item.section}">값</td>
                    <td th:text="${item.cnt}">값</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0">
            <div class="d-flex bd-highlight">
              <div class="p-2 flex-grow-1 bd-highlight">
                <h6>블로그 탭 포스팅 목록 </h6>
              </div>
            </div>
          </div>
          <div class="card-body px-0 pt-0 pb-2 justify-content-center mt-2">
            <div class="table-responsive p-0">
              <table class="table align-items-center mb-0">
                <thead>
                <tr class="text-center">
                  <th>블로그명</th>
                  <th>제목</th>
                  <th>작성일</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${dataList3}">
                  <td>
                    <a th:text="${item.blogName}" th:href="@{${item.blogUrl}}" target="_blank">값</a>
                  </td>
                  <td>
                    <a th:text="${item.glName}" th:href="@{${item.glUrl}}" target="_blank">값</a>
                  </td>
                  <td th:text="${item.glTime}">값</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div th:insert="~{common/mainfooter.html :: footer}"></div>
  </div>
</main>

<!-- Modal -->
<div class="modal fade" id="exampleModalMessage" tabindex="-1" role="dialog" aria-labelledby="exampleModalMessageTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">엑셀 업로드</h5>
        <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="form-group">
          <input type="file" id="excelFileInput" class="form-control">
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" id="closeBtn" class="btn bg-gradient-secondary" data-bs-dismiss="modal">닫기</button>
        <button type="button" id="confirmBtn" class="btn bg-gradient-success">등록</button>
      </div>
    </div>
  </div>
</div>


<div class="loader-wrapper">
  <div class="loader"></div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
<script th:inline="javascript">
  /*<![CDATA[*/
  var dataList = /*[[${dataList}]]*/ [];
  var myChart;
  var ctx = document.getElementById('line-chart').getContext('2d');
  if(dataList != null){
    myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: dataList.map(data => data['period']),
        datasets: [{
          label: 'Ratio',
          data: dataList.map(data => data['ratio']),
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  /*]]>*/
</script>
<script>
  $(document).ready(function(){

    var currentYear = new Date().getFullYear();
    var startYearSelect = $("#startYear_Sel");
    var endYearSelect = $("#endYear_Sel");
    for (var year = 2016; year <= currentYear; year++) {
      startYearSelect.append("<option value='" + year + "' >" + year + "</option>");
      endYearSelect.append("<option value='" + year + "'>" + year + "</option>");
    }
    // 시작 월과 종료 월을 동적으로 생성합니다
    var startMonthSelect = $("#startMonth_Sel");
    var endMonthSelect = $("#endMonth_Sel");
    for (var month = 1; month <= 12; month++) {
      startMonthSelect.append("<option value='" + month + "'>" + month + "</option>");
      endMonthSelect.append("<option value='" + month + "'>" + month + "</option>");
    }
    var currentYear = new Date().getFullYear();
    var currentMonth = new Date().getMonth() + 1; // 월은 0부터 시작하므로 1을 더합니다.
    // 시작 년도와 종료 년도의 기본값 설정
    startYearSelect.val(currentYear-1);
    endYearSelect.val(currentYear);

    // 시작 월과 종료 월의 기본값 설정
    startMonthSelect.val(currentMonth);
    endMonthSelect.val(currentMonth-1);

    // 오늘 날짜를 가져오는 함수
    function getToday() {
      var today = new Date();
      var year = today.getFullYear();
      var month = (today.getMonth() + 1).toString().padStart(2, '0'); // 월은 0부터 시작하므로 +1을 해줍니다.
      var day = today.getDate().toString().padStart(2, '0');
      return year + '-' + month + '-' + day;
    }
    // 한 달 전의 오늘 날짜를 가져오는 함수
    function getOneMonthAgo() {
      var today = new Date();
      var oneMonthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
      var year = oneMonthAgo.getFullYear();
      var month = (oneMonthAgo.getMonth() + 1).toString().padStart(2, '0');
      var day = oneMonthAgo.getDate().toString().padStart(2, '0');
      return year + '-' + month + '-' + day;
    }
    // endDate_Sel을 오늘 날짜로 설정
    document.getElementById('endDate_Sel').value = getToday();
    // startDate_Sel을 한 달 전의 오늘로 설정
    document.getElementById('startDate_Sel').value = getOneMonthAgo();

    $("#dateType_Sel").change(function(){
      if ($(this).val() === "daily") {
        $("#dailyInputs").show();
        $("#monthlyInputs").hide();
      } else if ($(this).val() === "monthly") {
        $("#dailyInputs").hide();
        $("#monthlyInputs").show();
      }
      var ctx = document.getElementById('line-chart').getContext('2d');

      // 이전 차트 객체가 존재한다면 삭제
      if (myChart !== null) {
        myChart.destroy();
      }

      var param;
      if($("#dateType_Sel").val() == 'daily'){
        param = {
          'keyword' : $("#keyword").val(),
          'dateType_Sel' : $("#dateType_Sel").val(),
          'startDate' : $("#startDate").val(),
          'endDate' : $("#endDate").val()
        };
      }else{
        param = {
          'keyword' : $("#keyword").val(),
          'dateType_Sel' : $("#dateType_Sel").val(),
          'startYear' : $("#startYear_Sel").val(),
          'startMonth' : $("#startMonth_Sel").val(),
          'endYear' : $("#endYear_Sel").val(),
          'endMonth' : $("#endMonth_Sel").val()
        };
      }
      console.log('param:', JSON.stringify(param));
      fetch('/trendsChart', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(param),
        //processData: false,
        //contentType: false,
      })
      .then(response => response.json())
      .then(dataList => {
        //console.log('Success:', dataList);
        myChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: dataList.map(data => data['period']),
            datasets: [{
              label: 'Ratio',
              data: dataList.map(data => data['ratio']),
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      })
      .catch(error => {
        console.error('등록 중 오류가 발생했습니다:', error);
      })
      .finally(() => {
        FunLoadingBarEnd();
      });
    });

    $("#submitBtn").click(function(){
      var url = "";
      if($("#dateType_Sel").val() == 'daily'){
        // 시작 날짜와 종료 날짜의 값을 가져옵니다.
        var startDate = $("#startDate_Sel").val();
        var endDate = $("#endDate_Sel").val();
        var keyword = $("#keyword").val();

        // URL을 조합합니다.
        url = "/trends?startDate=" + startDate + "&endDate=" + endDate + "&keyword=" + keyword;
      }else{
        var startYear = $("#startYear_Sel").val();
        var startMonth = $("#startMonth_Sel").val();
        var endYear = $("#endYear_Sel").val();
        var endMonth = $("#endMonth_Sel").val();
        var keyword = $("#keyword").val();

        url = "/trends2?startYear=" + startYear + "&startMonth=" + startMonth + "&endYear=" + endYear + "&endMonth=" + endMonth + "&keyword=" + keyword;;
      }

      // 조합된 URL로 이동합니다.
      window.location.href = url;
    });

  });

</script>
<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
<!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
<!--   Core JS Files   -->
<script src="/assets/js/core/popper.min.js"></script>
<script src="/assets/js/core/bootstrap.min.js"></script>
<!--  <script src="/assets/js/plugins/perfect-scrollbar.min.js"></script>-->
<!--  <script src="/assets/js/plugins/smooth-scrollbar.min.js"></script>-->

<!--  <script src="/assets/js/soft-ui-dashboard.min.js?v=1.0.7"></script>-->
<script src="/js/common.js"></script>
</body>

</html>