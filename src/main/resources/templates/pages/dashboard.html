<!--
=========================================================
* Soft UI Dashboard - v1.0.7
=========================================================

* Product Page: https://www.creative-tim.com/product/soft-ui-dashboard
* Copyright 2023 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="/assets/img/favicon.png">
  <title>
    BoostMarketer - 마케팅을 위한 플랫폼
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="/assets/css/soft-ui-dashboard.css?v=1.0.7" rel="stylesheet" />
  <link href="/css/table.css" rel="stylesheet" />
  <link href="/css/common.css" rel="stylesheet"/>
  <!-- Nepcha Analytics (nepcha.com) -->
  <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
  <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
</head>
<style>
    .post-hashtag {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: start; /* Keeps tags aligned to the start */
    }

    .hashtag {
        background-color: #f0f0f0; /* Even lighter gray */
        color: black; /* Lighter text color */
        padding: 4px 9px; /* Slightly smaller padding */
        border-radius: 15px; /* Less pronounced border-radius */
        margin: 4px; /* Slightly reduced space between tags */
        font-size: 12px; /* Slightly smaller text */
        border: 1px solid #e0e0e0; /* Lighter border */
        opacity: 0.8; /* Slightly transparent */
        overflow: hidden; /* Ensures content doesn't spill out */
        text-overflow: ellipsis; /* Adds an ellipsis for text that overflows */
        white-space: nowrap; /* Prevents text from wrapping to a new line */
    }
</style>

<body class="g-sidenav-show  bg-gray-100">
<div th:replace="~{common/aside}"></div>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <div th:replace="~{common/navbar}"></div>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">블로그 게시글 수</p>
                    <h5 class="font-weight-bolder mb-0" th:text="${blogMap.postCnt == 0 ? '0' : #numbers.formatInteger(blogMap.postCnt, 1, 'COMMA')}">
<!--                      <span class="text-success text-sm font-weight-bolder">+55%</span>-->
                    </h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                    <i class="ni ni-chart-bar-32 text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">상위노출 게시글 수</p>
                    <h5 class="font-weight-bolder mb-0" th:text="${blogMap.topPostsCnt}">
<!--                      <span class="text-success text-sm font-weight-bolder">+3%</span>-->
                    </h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                    <i class="ni ni-chart-bar-32 text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">키워드 수</p>
                    <h5 class="font-weight-bolder mb-0" th:text="${keywordMap.keywordCount}">
<!--                      <span class="text-danger text-sm font-weight-bolder">-2%</span>-->
                    </h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                    <i class="ni ni-chart-bar-32 text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">상위노출 키워드 수</p>
                    <h5 class="font-weight-bolder mb-0" th:text="${keywordMap.keywordRankCount}">
<!--                      <span class="text-success text-sm font-weight-bolder">+5%</span>-->
                    </h5>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                    <i class="ni ni-chart-bar-32 text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-12">
          <div class="card mb-4">
          <div class="card-header pb-0">
              <div class="d-flex bd-highlight">
                  <div class="p-2 flex-grow-1 bd-highlight">
                      <h6>최근 작성 게시글 현황 [1개월 기준]</h6>
                  </div>
                  <div class="p-2 bd-highlight">
                      <div style="width: 145px;" class="page-select-wrapper">
                          <select id="page-sort" style="width: 100%;" class="page-select">
                              <option value="recentPostDate" th:selected="${sort == 'recentPostDate'}">작성일자 최신순</option>
                              <option value="pastPostDate" th:selected="${sort == 'pastPostDate'}">작성일자 과거순</option>
                              <option value="highRank" th:selected="${sort == 'highRank'}">상위노출 많은순</option>
                              <option value="lowRank" th:selected="${sort == 'lowRank'}">상위노출 작은순</option>
                          </select>
                      </div>
                  </div>
                  <div th:insert="~{common/pageSelect}"></div>
              </div>
          </div>
            <div class="card-body px-0 pt-0 pb-2 justify-content-center mt-2">
              <div class="table-responsive p-0">
                <table class="table align-items-center mb-0">
                  <thead>
                  <tr>
                    <th rowspan="3" class="text-center text-uppercase text-secondary text-xs font-weight-bolder" style="width: 25%">블로그명</th>
                    <th rowspan="3" class="text-center text-uppercase text-secondary text-xs font-weight-bolder" style="width: 25%">게시글 제목</th>
                    <th rowspan="3" class="text-center text-uppercase text-secondary text-xs font-weight-bolder" style="width: 10%">작성일자</th>
                    <th colspan="2" class="text-center text-uppercase text-secondary text-xs font-weight-bolder" style="width: 25%">키워드 노출여부(블로그 탭)</th>
                    <th rowspan="3" class="text-center text-uppercase text-secondary text-xs font-weight-bolder">통합검색 <br>노출여부</th>
                    <th rowspan="3" class="text-center text-uppercase text-secondary text-xs font-weight-bolder"></th>
                  </tr>
                  <tr>
                    <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder">TOP 5</th>
                    <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder">TOP 10</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="list : ${resultList}">
                    <td>
                        <a target="_blank" th:href="'https://blog.naver.com/' + ${list.blogId}">
                          <div class="d-flex px-2 py-1">
                            <div>
                              <img th:src="${!#strings.isEmpty(list.blogImg) ? list.blogImg : 'assets/img/logo-ct-dark.png'}" class="avatar avatar-content me-3" alt="user1">
                            </div>
                            <div class="d-flex flex-column justify-content-center">
                              <h6 class="mb-0 text-sm" th:text="${list.blogName}"></h6>
                              <a class="text-xs text-secondary mb-0 link-primary" target="_blank" th:href="'https://blog.naver.com/' + ${list.blogId}" th:text="'https://blog.naver.com/' + ${list.blogId}"></a>
                            </div>
                          </div>
                        </a>
                    </td>
                    <td class="align-middle text-center">
                      <a target="_blank" th:href="'https://blog.naver.com/' + ${list.blogId} + '/' + ${list.postNo}"><p class="text-xs font-weight-bold mb-0" th:text="${list.postTitle}"></p></a>
                    </td>
                    <td class="align-middle text-center">
                      <p class="text-xs font-weight-bold mb-0" th:text="${list.postDate}"></p>
                    </td>
                    <td class="align-middle text-center" th:styleappend="${list.rankPc5 != 0} ? 'background-color: #fffff5;' : ''">
                      <p class="text-xs font-weight-bold mb-0" th:text="${list.rankPc5}"></p>
                    </td>
                    <td class="align-middle text-center" th:styleappend="${list.rankPc10 != 0} ? 'background-color: #fffff5;' : ''">
                      <p class="text-xs font-weight-bold mb-0" th:text="${list.rankPc10}"></p>
                    </td>
                      <td class="align-middle text-center" th:styleappend="${list.totalSearchExposure != 0} ? 'background-color: #fffff5;' : ''">
                        <span th:if="${list.totalSearchExposure != 0}" class="text-success">
                            <i class="fa fa-check"></i>
                        </span>
                          <span th:if="${list.totalSearchExposure == 0}" class="text-danger">
                            <i class="fa fa-times"></i>
                        </span>
                      </td>
                    <td class="align-middle text-center">
                      <a class="btn btn-link text-dark px-3 mb-0" th:onclick="'openModal(' + ${list.postNo} + ');'">
                          <i class="fas fa-external-link-alt" aria-hidden="true"></i>자세히
                      </a>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
          <nav id="pagination" aria-label="Page navigation example"></nav>
      </div>
      <div th:replace="~{common/mainfooter}"></div>
    </div>
  </main>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="width: 900px; max-width: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">정보</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
         <table class="table align-items-center mb-0">
              <thead>
              <tr>
                <th class="text-uppercase text-secondary text-xs font-weight-bolder" style="width: auto">게시글 제목</th>
                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder" style="width: 15%">작성일자</th>
                <th class="text-center text-uppercase text-secondary text-xs font-weight-bolder" style="width: 30%">키워드 [순위] [통합검색노출]</th>
              </tr>
              </thead>
              <tbody id="modal-body-content">
              </tbody>
            </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

  <!--   Core JS Files   -->
  <script src="/assets/js/core/popper.min.js"></script>
  <script src="/assets/js/core/bootstrap.min.js"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
<!--  <script src="/assets/js/soft-ui-dashboard.min.js?v=1.0.7"></script>-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/common.js"></script>
  <script>
      /*<![CDATA[*/
      const totalCount = [[${totalCount}]]; // 서버 사이드에서 전달된 'keywordCount' 값을 사용
      const page = [[${page}]]; // 서버 사이드에서 전달된 'page' 값을 사용
      const pageSize = [[${pageSize}]];
      const sort = '[[${sort}]]';
      /*]]>*/

      document.addEventListener('DOMContentLoaded', function () {
        var totalPages = Math.ceil(totalCount / pageSize);
        var groupSize = 5; // 한 번에 표시할 페이지 번호의 개수

        // 페이지 그룹의 시작과 끝 페이지 번호 계산
        var startPage = Math.floor((page - 1) / groupSize) * groupSize + 1;
        var endPage = Math.min(startPage + groupSize - 1, totalPages);

        function createPagination(currentPage, totalPages, startPage, endPage) {
          var paginationHTML = '<ul class="pagination pagination-secondary justify-content-center">';

          // 처음으로 이동
          paginationHTML += '<li class="page-item ' + (currentPage === 1 ? 'disabled' : '') + '">' +
                  '<a class="page-link" href="javascript:changePage(1);" aria-label="First">' +
                  '<i class="fa fa-angle-double-left" aria-hidden="true"></i></a></li>';

          // 이전 페이지로 이동
          var prevPage = currentPage - 1;
          paginationHTML += '<li class="page-item ' + (currentPage === 1 ? 'disabled' : '') + '">' +
                  '<a class="page-link" href="javascript:changePage(' + prevPage + ');" aria-label="Previous">' +
                  '<i class="fa fa-angle-left" aria-hidden="true"></i></a></li>';

          // 페이지 번호 버튼
          for (var i = startPage; i <= endPage; i++) {
            if (i === currentPage) {
              // 현재 페이지에 대해 클릭 불가능한 상태로 표시
              paginationHTML += '<li class="page-item active"><span class="page-link">' + i + '</span></li>';
            } else {
              paginationHTML += '<li class="page-item">' +
                      '<a class="page-link" href="javascript:changePage(' + i + ');">' + i + '</a></li>';
            }
          }

          // 다음 페이지로 이동
          var nextPage = currentPage + 1;
          paginationHTML += '<li class="page-item ' + (currentPage === totalPages ? 'disabled' : '') + '">' +
                  '<a class="page-link" href="javascript:changePage(' + nextPage + ');" aria-label="Next">' +
                  '<i class="fa fa-angle-right" aria-hidden="true"></i></a></li>';

          // 마지막으로 이동
          paginationHTML += '<li class="page-item ' + (currentPage === totalPages ? 'disabled' : '') + '">' +
                  '<a class="page-link" href="javascript:changePage(' + totalPages + ');" aria-label="Last">' +
                  '<i class="fa fa-angle-double-right" aria-hidden="true"></i></a></li>';

          paginationHTML += '</ul>';

          document.getElementById('pagination').innerHTML = paginationHTML;
        }

        window.changePage = function (page) {
          window.location.href = '/?page=' + page + '&pageSize=' + pageSize + '&sort=' + sort;
        }

        createPagination(page, totalPages, startPage, endPage);
      });


      function openModal(postNo) {
          fetch('/homeModal/' + postNo)
              .then(response => response.json())
              .then(data => {
                  const modal = document.getElementById('exampleModal');
                  const modalBody = modal.querySelector('#modal-body-content');

                  // Clear previous content
                  modalBody.innerHTML = '';

                  // Single post data
                  const post = data.blogPostDto;
                  let hashtags = [];
                  if (post.hashtag !== null) {
                      hashtags = post.hashtag.split(',');
                  }

                  // Construct new row for the post
                  let postRow = `
                <tr>
                    <td class="align-middle">
                        <a target="_blank">
                            <p class="btn btn-link text-dark text-sm font-weight-bold mb-0">${post.postTitle}</p>
                        </a>
                        <div class="post-hashtag">
                            ${hashtags.map(tag => `<div class="hashtag select">#${tag.trim()}</div>`).join('')}
                        </div>
                    </td>
                    <td class="align-middle text-center">
                        <p class="text-xs font-weight-bold mb-0">${post.postDate}</p>
                    </td>
                    <td class="align-middle text-center">
                        ${data.keywordDtos.map(keyword => `
                            <a style="display: block;" class="text-dark px-3 mb-0">
                                <p class="text-sm font-weight-bold" style="display: inline; padding-right: 5px">${keyword.keywordName}</p>
                                <p class="text-sm font-weight-bold" style="display: inline; color: #00c73c">${keyword.rankPc === 0 ? '-' : '[' + keyword.rankPc + '위]'}</p>
                                <p class="text-sm font-weight-bold" style="display: inline;">
                                    [
                                    <span class="${keyword.totalSearchExposure === 1 ? 'text-success' : 'text-danger'}">
                                        <i class="${keyword.totalSearchExposure === 1 ? 'fa fa-check' : 'fa fa-times'}"></i>
                                    </span>
                                    ]
                                </p>
                            </a>
                        `).join('')}
                    </td>
                </tr>
            `;

                  modalBody.innerHTML = postRow;

                  // Show the modal
                  const bsModal = new bootstrap.Modal(modal);
                  bsModal.show();
              })
              .catch(error => {
                  console.error('Error fetching data:', error);
              });
      }

  </script>
</body>

</html>